<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Users</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
</head>
<body th:with="userPages = ((${users.size()} - (${users.size()} % 19)))/19 + 1">
    <script src="/js/jquery-3.3.1.slim.min.js"></script>
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>

    <script>
        addEventListener("keydown", function (event) {
            switch (event.keyCode) {
                case 37:
                case 38:
                    document.getElementById("prevPage").click();
                    break;
                case 39:
                case 40:
                    document.getElementById("nextPage").click();
                    break;
                case 78:
                case 67:
                    location.href = '/admin/new';
                    break;
                case 70:
                    location.href = '/admin/filter';
                    break;
                case 83:
                    location.href = '/admin/search';
                    break;
                case 82:
                    location.href = '/admin/removeFilter';
                    break;
                case 72:
                    location.href = '/welcome';
                    break;
                case 77:
                case 85:
                    location.href = '/user';
                    break;
                case 76:
                    location.href = '/logout';
                    break;
            }
        });
    </script>


    <!-- Верхняя серая строчка -->
    <div class="row p-2 mx-0 align-items-center bg-dark">
        <div class="col-md-11">
            <a class="text-light text-decoration-none" href="/user">
                <b>[[${principal.getEmail()}]]</b> with roles: [[${principal.getUserRole()}]]
            </a>
        </div>
        <div class="col-md-1">
            <a class="text-white-50 text-decoration-none" href="/logout">Logout</a>
        </div>
    </div> <!-- /Верхняя серая строчка -->

    <!-- боковая панель -->
    <nav class="col-2 nav float-left d-inline-block p-0 pt-3 flex-column nav-pills">
        <a class="nav-link active" href="javascript:void(0);">Admin</a>
        <a class="nav-link" href="/user">User</a>
    </nav>

    <div class="col-10 d-inline-block bg-light">
            <h2 class="p-2 mt-2">Admin panel</h2>
            <div class="tabs" >
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#userstable">Users Table</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#newuser">New User</a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div class="p-3 border">
                        <h5 class="my-0">All Users</h5>
                    </div>

                    <table  class="table table-striped  table-hover">
                        <tr>
                            <th>ID</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Age</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Info</th>
                            <th>Edit</th>
                            <th>Delete</th>
                        </tr>
                        <tr th:each="user, itemStat : ${users}"
                            th:if="((${itemStat.count}>((${pageNum}*19)-19)) and (${itemStat.count}<((${pageNum}*19))) )">
                            <td th:text="'&nbsp;'+${user.getId()}">id</td>
                            <td th:text="${user.getFirstname()}">name</td>
                            <td th:text="${user.getLastname()}">lastname</td>
                            <td th:text="${user.getAge()}">age</td>
                            <td th:text="${user.getEmail()}">email</td>
                            <td th:text="${user.getUserRole()}">role</td>
                            <td>
                                <a th:href="@{/admin/{id}(id=${user.getId()})}">
                                    <button type="button" class="btn btn-sm btn-info">Info</button>
                                </a>
                            </td>
                            <td><a th:href="@{/admin/{id}/edit(id=${user.getId()})}">
                                <button type="button" class="btn btn-sm btn-info">Edit</button>
                            </a></td>
                            <td><a th:href="@{/admin/delete={id}(id=${user.getId()})}">
                                <button type="button" class="btn btn-sm btn-danger">Delete</button>
                            </a></td>
                        </tr>
                        <tr th:if="${(users.size()<=0)&&isFilterActive}">
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td><a>Info</a></td>
                            <td><a>Edit</a></td>
                            <td><a>Delete</a></td>
                        </tr>
                        <table>
                            <tr>
                                <td>
                                    <div id="content" style="font-size: smaller">
                                        <div>page [[${pageNum}]] of [[${userPages}]], users: [[${users.size()}]]</div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </table>
                </div>
                <div style="margin-top: 0.6em;">
                    <label th:if="${(users.size()<=0)&&isFilterActive}">No entries found<br><br></label>
                    <button th:if="${pageNum > 1}" type="button" id="prevPage">Prev page</button>
                    <button th:if="${pageNum <= 1}" type="button" disabled>Prev page</button>
                    <button th:if="${pageNum} < ${userPages}" type="button" id="nextPage">Next page</button>
                    <button th:if="${pageNum} >= ${userPages}" type="button" disabled>Next page</button>
                    <button th:if="${!isFilterActive}" id="refresh" type="button">Refresh</button>
                    <script type="text/javascript">
                        document.getElementById("prevPage").onclick = function () {
                            location.href = '/admin?page=[[${pageNum-1}]]'};
                    </script>
                    <script type="text/javascript">
                        document.getElementById("nextPage").onclick = function () {
                            location.href = '/admin?page=[[${pageNum+1}]]'};
                    </script>
                    <script type="text/javascript">
                        document.getElementById("refresh").onclick = function () {
                            location.href = '/admin'};
                    </script>
                </div>
                <div style="margin-top: 0.6em">
                    <button type="button" onclick="location.href = '/admin/new';">New User</button>
                    <button type="button" onclick="location.href = '/admin/filter';">Filter</button>
                    <button type="button" onclick="location.href = '/admin/search';">Search</button>
                    <button th:if="${isFilterActive}" type="button" onclick="location.href = '/admin/removeFilter';">Remove Filter</button>
                </div>
                <div style="margin-top: 0.6em">
                    <button type="button" onclick="location.href = '/welcome';">Homepage</button>
                    <button type="button" onclick="location.href = '/user';">My profile</button>
                    <button type="button" onclick="location.href = '/logout';">Logout</button>
                </div>
                <br>
                <br>
            </div>
    </div>
</body>
</html>